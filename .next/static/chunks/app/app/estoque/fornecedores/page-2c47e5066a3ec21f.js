(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[249],{12224:function(e,t,s){Promise.resolve().then(s.bind(s,71741))},71741:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return x}});var a=s(57437),r=s(2265),o=s(97024),l=s(58222);function n(e){let{suppliers:t,onEdit:s,onDelete:n}=e,{user:i}=(0,o.t)(),[c,d]=(0,r.useState)(null),u=async e=>{if(confirm("Tem certeza que deseja excluir este fornecedor?"))try{d(e),await (0,l.eT)(e),n()}catch(e){console.error("Erro ao excluir fornecedor:",e),alert("Erro ao excluir fornecedor")}finally{d(null)}},m=e=>e||"-",x=e=>e||"-",h=e=>{let t={ACTIVE:{label:"Ativo",className:"bg-green-100 text-green-800"},INACTIVE:{label:"Inativo",className:"bg-red-100 text-red-800"}}[e]||{label:e,className:"bg-gray-100 text-gray-800"};return(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(t.className),children:t.label})};return 0===t.length?(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-gray-500",children:"Nenhum fornecedor encontrado"})}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nome"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Contato"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Telefone"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"CNPJ"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),((null==i?void 0:i.role)==="ADMIN"||(null==i?void 0:i.role)==="MANAGER")&&(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A\xe7\xf5es"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.name}),e.email&&(0,a.jsx)("div",{className:"text-sm text-gray-500",children:e.email})]})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:e.contactName||"-"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:m(e.phone)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:x(e.cnpj)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:h(e.status)}),((null==i?void 0:i.role)==="ADMIN"||(null==i?void 0:i.role)==="MANAGER")&&(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>s(e),className:"text-indigo-600 hover:text-indigo-900",children:"Editar"}),(0,a.jsx)("button",{onClick:()=>u(e.id),disabled:c===e.id,className:"text-red-600 hover:text-red-900 disabled:opacity-50",children:c===e.id?"Excluindo...":"Excluir"})]})})]},e.id))})]})})}var i=s(61865),c=s(38110),d=s(92160);let u=d.Ry({name:d.Z_().min(2,"Nome deve ter pelo menos 2 caracteres"),email:d.Z_().email("Email inv\xe1lido").optional().or(d.i0("")),phone:d.Z_().min(10,"Telefone deve ter pelo menos 10 d\xedgitos").optional().or(d.i0("")),cnpj:d.Z_().min(14,"CNPJ deve ter 14 d\xedgitos").optional().or(d.i0("")),contactName:d.Z_().min(2,"Nome do contato deve ter pelo menos 2 caracteres").optional().or(d.i0("")),address:d.Z_().min(5,"Endere\xe7o deve ter pelo menos 5 caracteres").optional().or(d.i0("")),city:d.Z_().min(2,"Cidade deve ter pelo menos 2 caracteres").optional().or(d.i0("")),state:d.Z_().min(2,"Estado deve ter pelo menos 2 caracteres").optional().or(d.i0("")),zipCode:d.Z_().min(5,"CEP deve ter pelo menos 5 caracteres").optional().or(d.i0("")),notes:d.Z_().optional().or(d.i0("")),status:d.Km(["ACTIVE","INACTIVE"]).default("ACTIVE")});function m(e){let{supplier:t,onClose:s,onSuccess:o}=e,[n,d]=(0,r.useState)(!1),[m,x]=(0,r.useState)(null),{register:h,handleSubmit:p,formState:{errors:g},reset:f}=(0,i.cI)({resolver:(0,c.F)(u),defaultValues:t?{...t,status:"ACTIVE"===t.status||"INACTIVE"===t.status?t.status:"ACTIVE"}:{name:"",email:"",phone:"",cnpj:"",contactName:"",address:"",city:"",state:"",zipCode:"",notes:"",status:"ACTIVE"}});(0,r.useEffect)(()=>{t&&f({...t,status:"ACTIVE"===t.status||"INACTIVE"===t.status?t.status:"ACTIVE"})},[t,f]);let b=async e=>{try{d(!0),x(null),t?await (0,l.S6)(t.id,e):await (0,l.jm)(e),o()}catch(e){x("Erro ao salvar fornecedor. Tente novamente."),console.error("Erro ao salvar fornecedor:",e)}finally{d(!1)}};return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:t?"Editar Fornecedor":"Novo Fornecedor"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("form",{onSubmit:p(b),className:"space-y-4",children:[m&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:m}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome da Empresa *"}),(0,a.jsx)("input",{type:"text",...h("name"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nome da empresa"}),g.name&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.name.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),(0,a.jsx)("input",{type:"email",...h("email"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"email@exemplo.com"}),g.email&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.email.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Telefone"}),(0,a.jsx)("input",{type:"tel",...h("phone"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"(11) 99999-9999"}),g.phone&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.phone.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CNPJ"}),(0,a.jsx)("input",{type:"text",...h("cnpj"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"00.000.000/0000-00"}),g.cnpj&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.cnpj.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nome do Contato"}),(0,a.jsx)("input",{type:"text",...h("contactName"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Nome do contato principal"}),g.contactName&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.contactName.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Status"}),(0,a.jsxs)("select",{...h("status"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"ACTIVE",children:"Ativo"}),(0,a.jsx)("option",{value:"INACTIVE",children:"Inativo"})]}),g.status&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.status.message})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Endere\xe7o"}),(0,a.jsx)("input",{type:"text",...h("address"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Endere\xe7o completo"}),g.address&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.address.message})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cidade"}),(0,a.jsx)("input",{type:"text",...h("city"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Cidade"}),g.city&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.city.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Estado"}),(0,a.jsx)("input",{type:"text",...h("state"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Estado"}),g.state&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.state.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CEP"}),(0,a.jsx)("input",{type:"text",...h("zipCode"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"00000-000"}),g.zipCode&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.zipCode.message})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa\xe7\xf5es"}),(0,a.jsx)("textarea",{...h("notes"),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Observa\xe7\xf5es adicionais"}),g.notes&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:g.notes.message})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),(0,a.jsx)("button",{type:"submit",disabled:n,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:n?"Salvando...":t?"Atualizar":"Criar"})]})]})]})})}function x(){let{user:e}=(0,o.t)(),[t,s]=(0,r.useState)([]),[i,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(!1),[x,h]=(0,r.useState)(null);(0,r.useEffect)(()=>{p()},[]);let p=async()=>{try{c(!0);let e=await (0,l.rH)();s(e.data)}catch(e){console.error("Erro ao carregar fornecedores:",e)}finally{c(!1)}},g=()=>{u(!1),h(null)};return i?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Fornecedores"}),((null==e?void 0:e.role)==="ADMIN"||(null==e?void 0:e.role)==="MANAGER")&&(0,a.jsxs)("button",{onClick:()=>u(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Adicionar Fornecedor"]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,a.jsx)(n,{suppliers:t,onEdit:e=>{h(e),u(!0)},onDelete:p})}),d&&(0,a.jsx)(m,{supplier:x,onClose:g,onSuccess:()=>{p(),g()}})]})}},97024:function(e,t,s){"use strict";s.d(t,{t:function(){return i}});var a=s(94660),r=s(74810),o=s(58222);let l=(e,t)=>{try{localStorage.setItem(e,JSON.stringify(t));let s=JSON.stringify(t);document.cookie="".concat(e,"=").concat(encodeURIComponent(s),"; path=/; max-age=").concat(604800,"; SameSite=Lax")}catch(e){console.error("Erro ao salvar no storage:",e)}},n=e=>{try{let t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(e){return console.error("Erro ao ler do storage:",e),null}},i=(0,a.Ue)()((0,r.tJ)((e,t)=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isLoading:!1,error:null,login:async(t,s,a)=>{try{e({isLoading:!0,error:null});let{accessToken:r,refreshToken:n,user:i}=(await o.hi.post("/auth/login",{email:t,password:s,companyId:a})).data;console.log("\uD83D\uDD10 Dados de login recebidos:",{accessToken:!!r,refreshToken:!!n,user:i}),o.hi.defaults.headers.common.Authorization="Bearer ".concat(r),e({user:i,accessToken:r,refreshToken:n,isAuthenticated:!0,isLoading:!1,error:null}),console.log("\uD83D\uDD10 Estado atualizado com sucesso"),l("auth-storage",{user:i,accessToken:r,refreshToken:n,isAuthenticated:!0}),await new Promise(e=>setTimeout(e,0))}catch(s){var r,n;let t=(null===(n=s.response)||void 0===n?void 0:null===(r=n.data)||void 0===r?void 0:r.message)||"Erro ao fazer login";throw e({isLoading:!1,error:t,isAuthenticated:!1}),Error(t)}},register:async t=>{try{e({isLoading:!0,error:null});let{accessToken:s,refreshToken:a,user:r}=(await o.hi.post("/auth/register",t)).data;o.hi.defaults.headers.common.Authorization="Bearer ".concat(s),e({user:r,accessToken:s,refreshToken:a,isAuthenticated:!0,isLoading:!1,error:null}),await new Promise(e=>setTimeout(e,0))}catch(r){var s,a;let t=(null===(a=r.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"Erro ao fazer cadastro";throw e({isLoading:!1,error:t,isAuthenticated:!1}),Error(t)}},logout:()=>{delete o.hi.defaults.headers.common.Authorization,e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isLoading:!1,error:null}),l("auth-storage",{user:null,accessToken:null,refreshToken:null,isAuthenticated:!1})},refreshAccessToken:async()=>{try{let{refreshToken:s}=t();if(!s)throw Error("Token de refresh n\xe3o encontrado");let{accessToken:a}=(await o.hi.post("/auth/refresh",{refreshToken:s})).data;e({accessToken:a,isAuthenticated:!0}),o.hi.defaults.headers.common.Authorization="Bearer ".concat(a)}catch(e){throw t().logout(),e}},clearError:()=>{e({error:null})},setLoading:t=>{e({isLoading:t})},checkAuthStatus:()=>{let s=t();console.log("\uD83D\uDD0D Verificando status de autentica\xe7\xe3o:",{isAuthenticated:s.isAuthenticated,hasUser:!!s.user,hasToken:!!s.accessToken});let a=n("auth-storage");console.log("\uD83D\uDCE6 Dados armazenados:",a),a&&a.accessToken&&!s.accessToken&&(console.log("\uD83D\uDD04 Restaurando dados do storage"),e({user:a.user,accessToken:a.accessToken,refreshToken:a.refreshToken,isAuthenticated:a.isAuthenticated}),a.accessToken&&(o.hi.defaults.headers.common.Authorization="Bearer ".concat(a.accessToken))),s.accessToken&&!s.isAuthenticated&&(console.log("\uD83D\uDD27 Corrigindo estado de autentica\xe7\xe3o"),e({isAuthenticated:!0}))}}),{name:"auth-storage",partialize:e=>({user:e.user,accessToken:e.accessToken,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated})}))}},function(e){e.O(0,[737,865,727,239,222,971,938,744],function(){return e(e.s=12224)}),_N_E=e.O()}]);