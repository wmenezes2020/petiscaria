(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[997],{7974:function(e,t,s){Promise.resolve().then(s.bind(s,74386))},74386:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return h}});var a=s(57437),r=s(2265),o=s(97024),n=s(58222);function l(e){let{purchases:t,onEdit:s,onRefresh:l}=e,{user:i}=(0,o.t)(),[c,d]=(0,r.useState)(null),u=async e=>{if(confirm("Tem certeza que deseja confirmar esta compra?"))try{d(e),await (0,n.pF)(e),l()}catch(e){console.error("Erro ao confirmar compra:",e),alert("Erro ao confirmar compra")}finally{d(null)}},m=async e=>{if(confirm("Tem certeza que deseja cancelar esta compra?"))try{d(e),await (0,n.KL)(e),l()}catch(e){console.error("Erro ao cancelar compra:",e),alert("Erro ao cancelar compra")}finally{d(null)}},x=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e),h=e=>new Date(e).toLocaleDateString("pt-BR"),p=e=>{let t={PENDING:{label:"Pendente",className:"bg-yellow-100 text-yellow-800"},CONFIRMED:{label:"Confirmada",className:"bg-green-100 text-green-800"},CANCELLED:{label:"Cancelada",className:"bg-red-100 text-red-800"},RECEIVED:{label:"Recebida",className:"bg-blue-100 text-blue-800"}}[e]||{label:e,className:"bg-gray-100 text-gray-800"};return(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-medium rounded-full ".concat(t.className),children:t.label})};return 0===t.length?(0,a.jsx)("div",{className:"text-center py-8",children:(0,a.jsx)("p",{className:"text-gray-500",children:"Nenhuma compra encontrada"})}):(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Data"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Fornecedor"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Total"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),((null==i?void 0:i.role)==="ADMIN"||(null==i?void 0:i.role)==="MANAGER")&&(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"A\xe7\xf5es"})]})}),(0,a.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:h(e.purchaseDate)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:(0,a.jsx)("div",{className:"text-sm font-medium text-gray-900",children:e.supplierId||"N/A"})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:x(e.total)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:p(e.status)}),((null==i?void 0:i.role)==="ADMIN"||(null==i?void 0:i.role)==="MANAGER")&&(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>s(e),className:"text-indigo-600 hover:text-indigo-900",children:"Editar"}),"PENDING"===e.status&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>u(e.id),disabled:c===e.id,className:"text-green-600 hover:text-green-900 disabled:opacity-50",children:c===e.id?"Confirmando...":"Confirmar"}),(0,a.jsx)("button",{onClick:()=>m(e.id),disabled:c===e.id,className:"text-red-600 hover:text-red-900 disabled:opacity-50",children:c===e.id?"Cancelando...":"Cancelar"})]})]})})]},e.id))})]})})}var i=s(61865),c=s(38110),d=s(92160);let u=d.Ry({ingredientId:d.Z_().uuid("Selecione um ingrediente"),quantity:d.dj(e=>parseFloat(d.Z_().parse(e)||"0"),d.Rx().min(.01,"Quantidade deve ser maior que zero")),unitCost:d.dj(e=>parseFloat(d.Z_().parse(e)||"0"),d.Rx().min(.01,"Pre\xe7o unit\xe1rio deve ser maior que zero")),notes:d.Z_().optional()}),m=d.Ry({supplierId:d.Z_().uuid("Selecione um fornecedor"),purchaseDate:d.Z_().min(1,"Data da compra \xe9 obrigat\xf3ria"),expectedDeliveryDate:d.Z_().optional(),items:d.IX(u).min(1,"Adicione pelo menos um item"),notes:d.Z_().optional(),taxAmount:d.dj(e=>parseFloat(d.Z_().parse(e)||"0"),d.Rx().min(0,"Valor do imposto deve ser maior ou igual a zero")).optional()});function x(e){let{purchase:t,onClose:s,onSuccess:o}=e,[l,d]=(0,r.useState)(!1),[u,x]=(0,r.useState)(null),[h,p]=(0,r.useState)([]),[g,f]=(0,r.useState)([]),{register:b,handleSubmit:y,control:v,watch:j,setValue:N,formState:{errors:w},reset:k}=(0,i.cI)({resolver:(0,c.F)(m),defaultValues:t||{supplierId:"",purchaseDate:new Date().toISOString().split("T")[0],expectedDeliveryDate:"",items:[{ingredientId:"",quantity:0,unitCost:0,notes:""}],notes:"",taxAmount:0}}),{fields:D,append:A,remove:C}=(0,i.Dq)({control:v,name:"items"});(0,r.useEffect)(()=>{E(),t&&k(t)},[t,k]);let E=async()=>{try{let[e,t]=await Promise.all([(0,n.rH)(),(0,n.AE)()]);p(e.data),f(t)}catch(e){console.error("Erro ao carregar dados:",e)}},T=async e=>{try{d(!0),x(null),t?await (0,n.CD)(t.id,e):await (0,n.QU)(e),o()}catch(e){x("Erro ao salvar compra. Tente novamente."),console.error("Erro ao salvar compra:",e)}finally{d(!1)}},I=e=>{D.length>1&&C(e)},S=()=>j("items").reduce((e,t)=>e+t.quantity*t.unitCost,0),L=e=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(e);return(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,a.jsxs)("div",{className:"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold",children:t?"Editar Compra":"Nova Compra"}),(0,a.jsx)("button",{onClick:s,className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,a.jsxs)("form",{onSubmit:y(T),className:"space-y-6",children:[u&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded",children:u}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fornecedor *"}),(0,a.jsxs)("select",{...b("supplierId"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"Selecione um fornecedor"}),h.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),w.supplierId&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.supplierId.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data da Compra *"}),(0,a.jsx)("input",{type:"date",...b("purchaseDate"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"}),w.purchaseDate&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.purchaseDate.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Data de Entrega Esperada"}),(0,a.jsx)("input",{type:"date",...b("expectedDeliveryDate"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa\xe7\xf5es"}),(0,a.jsx)("textarea",{...b("notes"),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Observa\xe7\xf5es sobre a compra"})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:"Itens da Compra"}),(0,a.jsx)("button",{type:"button",onClick:()=>{A({ingredientId:"",quantity:0,unitCost:0,notes:""})},className:"bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded-md text-sm",children:"+ Adicionar Item"})]}),(0,a.jsx)("div",{className:"space-y-4",children:D.map((e,t)=>{var s,r,o,n,l,i,c,d,u,m,x,h;return(0,a.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ingrediente *"}),(0,a.jsxs)("select",{...b("items.".concat(t,".ingredientId")),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"Selecione um ingrediente"}),g.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(null===(r=w.items)||void 0===r?void 0:null===(s=r[t])||void 0===s?void 0:s.ingredientId)&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:null===(n=w.items[t])||void 0===n?void 0:null===(o=n.ingredientId)||void 0===o?void 0:o.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Quantidade *"}),(0,a.jsx)("input",{type:"number",step:"0.01",...b("items.".concat(t,".quantity")),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"}),(null===(i=w.items)||void 0===i?void 0:null===(l=i[t])||void 0===l?void 0:l.quantity)&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:null===(d=w.items[t])||void 0===d?void 0:null===(c=d.quantity)||void 0===c?void 0:c.message})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Pre\xe7o Unit\xe1rio *"}),(0,a.jsx)("input",{type:"number",step:"0.01",...b("items.".concat(t,".unitCost")),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"}),(null===(m=w.items)||void 0===m?void 0:null===(u=m[t])||void 0===u?void 0:u.unitCost)&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:null===(h=w.items[t])||void 0===h?void 0:null===(x=h.unitCost)||void 0===x?void 0:x.message})]}),(0,a.jsxs)("div",{className:"flex items-end space-x-2",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observa\xe7\xf5es"}),(0,a.jsx)("input",{type:"text",...b("items.".concat(t,".notes")),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Observa\xe7\xf5es do item"})]}),D.length>1&&(0,a.jsx)("button",{type:"button",onClick:()=>I(t),className:"text-red-600 hover:text-red-800 p-2",children:(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]})},e.id)})}),w.items&&(0,a.jsx)("p",{className:"text-red-500 text-sm mt-1",children:w.items.message})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Valor dos Impostos"}),(0,a.jsx)("input",{type:"number",step:"0.01",...b("taxAmount"),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"0.00"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Subtotal:"}),(0,a.jsx)("span",{className:"font-medium",children:L(S())})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:"Impostos:"}),(0,a.jsx)("span",{className:"font-medium",children:L(j("taxAmount")||0)})]}),(0,a.jsxs)("div",{className:"flex justify-between border-t pt-2",children:[(0,a.jsx)("span",{className:"text-lg font-semibold",children:"Total:"}),(0,a.jsx)("span",{className:"text-lg font-semibold text-blue-600",children:L(S()+(j("taxAmount")||0))})]})]})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,a.jsx)("button",{type:"button",onClick:s,className:"px-4 py-2 text-gray-700 bg-gray-200 rounded-md hover:bg-gray-300",children:"Cancelar"}),(0,a.jsx)("button",{type:"submit",disabled:l,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:l?"Salvando...":t?"Atualizar":"Criar"})]})]})]})})}function h(){let{user:e}=(0,o.t)(),[t,s]=(0,r.useState)([]),[i,c]=(0,r.useState)(!0),[d,u]=(0,r.useState)(!1),[m,h]=(0,r.useState)(null);(0,r.useEffect)(()=>{p()},[]);let p=async()=>{try{c(!0);let e=await (0,n.GP)();s(e.data)}catch(e){console.error("Erro ao carregar compras:",e)}finally{c(!1)}},g=()=>{u(!1),h(null)};return i?(0,a.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}):(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Hist\xf3rico de Compras"}),((null==e?void 0:e.role)==="ADMIN"||(null==e?void 0:e.role)==="MANAGER")&&(0,a.jsxs)("button",{onClick:()=>u(!0),className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Nova Compra"]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,a.jsx)(l,{purchases:t,onEdit:e=>{h(e),u(!0)},onRefresh:p})}),d&&(0,a.jsx)(x,{purchase:m,onClose:g,onSuccess:()=>{p(),g()}})]})}},97024:function(e,t,s){"use strict";s.d(t,{t:function(){return i}});var a=s(94660),r=s(74810),o=s(58222);let n=(e,t)=>{try{localStorage.setItem(e,JSON.stringify(t));let s=JSON.stringify(t);document.cookie="".concat(e,"=").concat(encodeURIComponent(s),"; path=/; max-age=").concat(604800,"; SameSite=Lax")}catch(e){console.error("Erro ao salvar no storage:",e)}},l=e=>{try{let t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(e){return console.error("Erro ao ler do storage:",e),null}},i=(0,a.Ue)()((0,r.tJ)((e,t)=>({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isLoading:!1,error:null,login:async(t,s,a)=>{try{e({isLoading:!0,error:null});let{accessToken:r,refreshToken:l,user:i}=(await o.hi.post("/auth/login",{email:t,password:s,companyId:a})).data;console.log("\uD83D\uDD10 Dados de login recebidos:",{accessToken:!!r,refreshToken:!!l,user:i}),o.hi.defaults.headers.common.Authorization="Bearer ".concat(r),e({user:i,accessToken:r,refreshToken:l,isAuthenticated:!0,isLoading:!1,error:null}),console.log("\uD83D\uDD10 Estado atualizado com sucesso"),n("auth-storage",{user:i,accessToken:r,refreshToken:l,isAuthenticated:!0}),await new Promise(e=>setTimeout(e,0))}catch(s){var r,l;let t=(null===(l=s.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.message)||"Erro ao fazer login";throw e({isLoading:!1,error:t,isAuthenticated:!1}),Error(t)}},register:async t=>{try{e({isLoading:!0,error:null});let{accessToken:s,refreshToken:a,user:r}=(await o.hi.post("/auth/register",t)).data;o.hi.defaults.headers.common.Authorization="Bearer ".concat(s),e({user:r,accessToken:s,refreshToken:a,isAuthenticated:!0,isLoading:!1,error:null}),await new Promise(e=>setTimeout(e,0))}catch(r){var s,a;let t=(null===(a=r.response)||void 0===a?void 0:null===(s=a.data)||void 0===s?void 0:s.message)||"Erro ao fazer cadastro";throw e({isLoading:!1,error:t,isAuthenticated:!1}),Error(t)}},logout:()=>{delete o.hi.defaults.headers.common.Authorization,e({user:null,accessToken:null,refreshToken:null,isAuthenticated:!1,isLoading:!1,error:null}),n("auth-storage",{user:null,accessToken:null,refreshToken:null,isAuthenticated:!1})},refreshAccessToken:async()=>{try{let{refreshToken:s}=t();if(!s)throw Error("Token de refresh n\xe3o encontrado");let{accessToken:a}=(await o.hi.post("/auth/refresh",{refreshToken:s})).data;e({accessToken:a,isAuthenticated:!0}),o.hi.defaults.headers.common.Authorization="Bearer ".concat(a)}catch(e){throw t().logout(),e}},clearError:()=>{e({error:null})},setLoading:t=>{e({isLoading:t})},checkAuthStatus:()=>{let s=t();console.log("\uD83D\uDD0D Verificando status de autentica\xe7\xe3o:",{isAuthenticated:s.isAuthenticated,hasUser:!!s.user,hasToken:!!s.accessToken});let a=l("auth-storage");console.log("\uD83D\uDCE6 Dados armazenados:",a),a&&a.accessToken&&!s.accessToken&&(console.log("\uD83D\uDD04 Restaurando dados do storage"),e({user:a.user,accessToken:a.accessToken,refreshToken:a.refreshToken,isAuthenticated:a.isAuthenticated}),a.accessToken&&(o.hi.defaults.headers.common.Authorization="Bearer ".concat(a.accessToken))),s.accessToken&&!s.isAuthenticated&&(console.log("\uD83D\uDD27 Corrigindo estado de autentica\xe7\xe3o"),e({isAuthenticated:!0}))}}),{name:"auth-storage",partialize:e=>({user:e.user,accessToken:e.accessToken,refreshToken:e.refreshToken,isAuthenticated:e.isAuthenticated})}))}},function(e){e.O(0,[737,865,727,239,222,971,938,744],function(){return e(e.s=7974)}),_N_E=e.O()}]);